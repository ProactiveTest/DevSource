@page "/pdf/cashtillrecon"
@attribute [MustHavePermission(FSHAction.View, FSHResource.PDF)]
@inject IPDFClient pdfservice
@inject IJSRuntime JSRuntime

<!DOCTYPE html>
<html>
<head>
    <title>Cash Till Reconciliation</title>

</head>
<body>
    <div class=" bg-light bg-gradient text-dark">

        <div class="col-lg-12 bg-secondary bg-gradient text-white" style="margin-left:auto;margin-right:auto;  width:80% ">
            @if (DialogIsOpen)
            {
                <MudAlert Severity="MudBlazor.Severity.Warning" Variant="Variant.Filled">Please wait document generating and downloading</MudAlert>
            }

            @if (reportdata != null)
            {
                <embed src="@reportdata" visible="false" width="1500" height="2000" />
            }

            <table style="border:1px solid black;margin-left:auto;margin-right:auto;  width:100%">
                <tr>
                    <td><p class="text-center"><h4><strong>Cash Till Reconciliation</strong></h4></p></td>
                    <td><MudFab Color="Color.Info" StartIcon="@Icons.Material.Filled.Print" Label="Print Cash Till Reconcilliation" OnClick="CreateCashTillRecon" /></td>
                </tr>
            </table>



        </div>

        <div class="col-lg-12" style="border:1px solid black;margin-left:auto;margin-right:auto;  width:80%">
            <div class="row ">

                <div class="col-xs-4 from">
                    <ul class="list-unstyled mb0">
                        <li><strong>For User:</strong> NDU</li>
                        <li><strong>Till Acc:</strong> 32060</li>
                        <li><strong>Date From:</strong> 24 Jul 23 - 24 Jul 23 </li>
                        <li><strong>Type:</strong> Totals Only</li>
                        <li><strong>Vendor No:</strong></li>
                        <li><strong>Date Printed</strong> 24 Jul 23<span class="label label-danger"></span></li>
                        <li><strong></strong> <span class="label label-danger"></span></li>
                    </ul>
                </div>
            </div>

            <br />
            <br />

            <div class="col-lg-12" style="margin-left:auto;margin-right:auto;  width:90%">
                <div class="row bg-info">
                    <table>
                        <tr>
                            <td>
                                USR
                            </td>
                            <td>
                                Rep
                            </td>
                            <td>
                                L
                            </td>
                            <td>
                                AccNo
                            </td>
                            <td>
                                Date
                            </td>
                            <td>
                                TP
                            </td>
                            <td>
                                RefCode
                            </td>
                            <td>
                                Amount
                            </td>
                            <td>
                                Description
                            </td>
                            <td>
                                PostDate
                            </td>
                        </tr>
                    </table>
                </div>
            </div>

            <br />
            <br />
            <div class="col-lg-12 " style="border:1px solid black;margin-left:auto;margin-right:auto;  width:50%">
                <div class="row ">
                    <div tabindex="0" class="col-xs-12">
                        <div class="card">
                            <div class="card-body bg-info bg-gradient text-dark ">
                                <h5 class="card-title"><strong>TILL TOTALS for USER 1 - NDU</strong></h5>
                                <p class="card-text text-black">
                                    As an added protection against till fraud, the first column lists the Totals from the Till Control file for the selected date(s).
                                    The second column  lists Totals calculated now from the actual transactions posted on the selected date(s)
                                    If there was Mixed Tender on some postings, some of the totals (Cheques, Cash, etc) ,ay not agree, but the Till Totals should agree.
                                </p>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <br />
            <br />

            <div class="col-lg-12">
                <div class="row ">
                    <div tabindex="0" class="col-xs-12 ">

                        <table class="bg-secondary bg-gradient text-white" style="border:1px solid black;margin-left:auto;margin-right:auto;  width:80%">
                            <tr>
                                <td width="40%" colspan="1">
                                    <strong>Till Totals for the selected date(s)</strong>
                                </td>
                                <td width="10%">
                                </td>
                                <td width="10%">
                                </td>
                                <td width="40%" style="text-align:center;">
                                    <strong>Totals based on the actual transaction entries</strong>
                                </td>

                            </tr>
                            <tr>
                                <td width="40%">
                                    CASH FLOAT
                                </td>
                                <td width="10%">
                                    0.00
                                </td>
                                <td width="10%">
                                </td>

                                <td width="40%" style="text-align:center;">
                                    0.00
                                </td>

                            </tr>
                            <tr>
                                <td width="40%">
                                    CASH
                                </td>
                                <td width="10%">
                                    4600.00
                                </td>
                                <td width="10%">
                                </td>

                                <td width="40%" style="text-align:center;">
                                    0.00
                                </td>
                            </tr>
                            <tr>
                                <td width="40%">
                                    Cheques
                                </td>
                                <td width="10%">
                                    0.00
                                </td>
                                <td width="10%">
                                </td>
                                <td width="40%" style="text-align:center;">
                                    0.00
                                </td>
                            </tr>
                            <tr>
                                <td width="40%">
                                    Credit Cards
                                </td>
                                <td width="10%">
                                    0.00
                                </td>
                                <td width="10%">
                                </td>
                                <td width="40%" style="text-align:center;">
                                    0.00
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Electronic Transfers
                                </td>
                                <td>
                                    0.00
                                </td>
                                <td>
                                </td>
                                <td style="text-align:center;">
                                    0.00
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Vouchers
                                </td>
                                <td>
                                    0.00
                                </td>
                                <td>
                                </td>
                                <td style="text-align:center;">
                                    0.00
                                </td>
                            </tr>

                            <tr>
                                <td>
                                    Other
                                </td>
                                <td>
                                    0.00
                                </td>
                                <td>
                                </td>
                                <td style="text-align:center;">
                                    0.00
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Mixed Tender
                                </td>
                                <td>
                                    0.00
                                </td>
                                <td>
                                </td>
                                <td style="text-align:center;">
                                    0.00
                                </td>
                            </tr>

                            <tr>
                                <td>
                                    <strong>Total in Till</strong>
                                </td>
                                <td>
                                    <strong>4600.00</strong>
                                </td>
                                <td>
                                </td>
                                <td style="text-align:center;">
                                    <strong>4600.00</strong>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div class='row mb-5'>
                        <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </p>
                    </div>

                    <br />
                    <br />
                    <div tabindex="0" class="col-xs-12">

                        <table class="bg-secondary bg-gradient text-white" style="border:1px solid black;margin-left:auto;margin-right:auto; width:80%;">
                            <tr>
                                <td width="40%">
                                    Total Refunds
                                </td>
                                <td width="10%">
                                    0.00
                                </td>
                                <td width="10%">
                                </td>

                                <td width="40%" style="text-align:center;">
                                </td>

                            </tr>
                            <tr>
                                <td width="40%">
                                    Total Refunds
                                </td>
                                <td width="10%">
                                    0.00
                                </td>
                                <td width="10%">
                                </td>

                                <td width="40%" style="text-align:center;">
                                </td>
                            </tr>
                            <tr>
                                <td width="40%">
                                    Total Taxable Sales
                                </td>
                                <td width="10%">
                                    0.00
                                </td>
                                <td width="10%">
                                </td>
                                <td width="40%" style="text-align:center;">
                                </td>
                            </tr>
                            <tr>
                                <td width="40%">
                                    Total NonTaxable
                                    Sales
                                </td>
                                <td width="10%">
                                    0.00
                                </td>
                                <td width="10%">
                                </td>
                                <td width="40%" style="text-align:center;">
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Total Debtor Receipts
                                </td>
                                <td>
                                    0.00
                                </td>
                                <td style="text-align:right;">
                                    Total Debtor
                                    Refunds
                                </td>
                                <td style="text-align:center;">
                                    0.00
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Total Creditor Payments
                                </td>
                                <td>
                                    0.00
                                </td>
                                <td>
                                </td>
                                <td style="text-align:center;">
                                </td>
                            </tr>


                        </table>
                    </div>


                </div>
            </div>


        </div>

    </div>
    @* 	<div class ="col-lg-12 bg-secondary bg-gradient text-white" style="margin-left:auto;margin-right:auto;  width:80% ">

    @if (!string.IsNullOrEmpty(pdfContent))
    {
    @*  <embed src="@pdfContent" width="800px" height="2100px" />
    <iframe src="@pdfContent" width="800px" height="2100px" sandbox="allow-popup" />
    @* <object data="@pdfContent" width="500" height="200"></object>
    }
    </div> *@

</body>


</html>

<style>
    .top-align {
        vertical-align: top;
    }

    .body {
        margin-top: 10px;
        background: #eee;
    }
</style>


@code {


    private bool DialogIsOpen = false;
    private string reportdata;
    string pdfContent = "";
    void GetPDF(byte[] data)
    {

        reportdata = "data:application/pdf;base64," + Convert.ToBase64String(data);
    }

    async void CreateCashTillRecon()
    {

        try
        {
            DialogIsOpen = true;
            StateHasChanged();
            var ms = new MemoryStream();
            //ms = await pdfservice.GetCashTillRecon();

            PDFDto dto = await pdfservice.GetCashTillReconAsync();
            ms = new MemoryStream(dto.FileStreamResultArray);



            pdfContent = "data:application/pdf;base64,";
            pdfContent += System.Convert.ToBase64String(ms.ToArray());

            StateHasChanged();

            await JSRuntime.SaveAs("Cash Till Recon.pdf", ms.ToArray());
            JSRuntime.OpenNewTab("Cash Till Recon.pdf", ms.ToArray());

            DialogIsOpen = false;

        }
        catch (Exception ex)
        {

            throw ex;
        }

    }

}